<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Ball Balancer Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
  </head>
  <body>
    <h1>Ball Balancer Web Dashboard</h1>

    <div id="status-box">
      SocketIO status:
      <span id="socket-status" class="status-disconnected">Disconnected</span>
      &nbsp;|&nbsp;
      Device info:
      <span id="device-id-label" class="info">(waiting for hello...)</span>
    </div>

    <div class="grid">
      <!-- 3D 플랫폼 -->
      <section class="card">
        <h2>Platform Pose (3D)</h2>
        <div id="platform-container"></div>
        <div class="pose-values small-note">
        roll: <span id="platform-roll-value">0.00</span>°
        &nbsp;&nbsp;
        pitch: <span id="platform-pitch-value">0.00</span>°
      </div>
      </section>

      <!-- Target Plane (실제 크기 + ball_pose) -->
      <section class="card">
        <h2>Target Plane</h2>
        <p class="small-note">
          Field size:
          <span id="field-size-label">unknown</span>
        </p>
        <canvas id="target-canvas"></canvas>
        <p class="small-note">
          actual pose: (
          <span id="ball-x-val">0</span>,
          <span id="ball-y-val">0</span>
          ) → target pose: (
          <span id="tar-x-val">0</span>,
          <span id="tar-y-val">0</span>
          )
        </p>
          <div class="circle-control">
            <button id="circle-toggle-btn" class="icon-button" title="Circle mode">
              ● Circle
            </button>

            <div id="circle-panel" class="circle-panel hidden">
              <label>
                R:
                <input type="number" id="circle-radius" value="70" step="1">
              </label>
              <label>
                Speed:
                <input type="number" id="circle-speed" value="0.1" step="0.1">
              </label>
              <button id="circle-start-btn" class="small-btn">Start</button>
              <button id="circle-stop-btn" class="small-btn">Stop</button>
            </div>
          </div>
      </section>

      <!-- Joystick 카드 -->
      <section class="card">
        <h2>Joystick</h2>
        <canvas id="joystick-canvas" width="260" height="260"></canvas>
        <p class="small-note">
          joystick (normalized): (
          <span id="joy-x-val">0.00</span>,
          <span id="joy-y-val">0.00</span>
          )
        </p>
      </section>

      <!-- 상태 raw 확인용 (디버깅용) -->
      <section class="card">
        <h2>Last status JSON (debug)</h2>
        <pre id="status-json" class="status-json"></pre>
      </section>

      <!-- PID Control Card -->
      <section class="card">
        <h2>PID Control</h2>

        <div class="pid-grid">

          <!-- X-axis PID -->
          <div class="pid-col">
            <h3>X-axis</h3>

            <div class="pid-row">
              <label for="kp-x-slider">Kp_x:</label>
              <input type="range" id="kp-x-slider" min="0" max="5" step="0.01" value="0">
              <span id="kp-x-value">0.00</span>
            </div>

            <div class="pid-row">
              <label for="ki-x-slider">Ki_x:</label>
              <input type="range" id="ki-x-slider" min="0" max="5" step="0.01" value="0">
              <span id="ki-x-value">0.00</span>
            </div>

            <div class="pid-row">
              <label for="kd-x-slider">Kd_x:</label>
              <input type="range" id="kd-x-slider" min="0" max="5" step="0.01" value="0">
              <span id="kd-x-value">0.00</span>
            </div>
          </div>

          <!-- Y-axis PID -->
          <div class="pid-col">
            <h3>Y-axis</h3>

            <div class="pid-row">
              <label for="kp-y-slider">Kp_y:</label>
              <input type="range" id="kp-y-slider" min="0" max="5" step="0.01" value="0">
              <span id="kp-y-value">0.00</span>
            </div>

            <div class="pid-row">
              <label for="ki-y-slider">Ki_y:</label>
              <input type="range" id="ki-y-slider" min="0" max="5" step="0.01" value="0">
              <span id="ki-y-value">0.00</span>
            </div>

            <div class="pid-row">
              <label for="kd-y-slider">Kd_y:</label>
              <input type="range" id="kd-y-slider" min="0" max="5" step="0.01" value="0">
              <span id="kd-y-value">0.00</span>
            </div>
          </div>
        </div>

        <button id="pid-apply-btn" class="pid-button">Apply</button>
        <button id="pid-reset-btn" class="pid-button">Reset</button>


        <!-- Target 숫자 입력 + Center 버튼 -->
        <div class="pid-row">
          <label>Target:</label>
          <input type="number" id="target-x" step="0.01" value="0.0" style="width:80px;">
          <span>,</span>
          <input type="number" id="target-y" step="0.01" value="0.0" style="width:80px;">
        </div>

        <!-- 방향키 패드 -->
        <div class="pid-row">
          <label></label>
          <div class="target-arrow-grid">
            <div class="arrow-row">
              <button id="target-up-btn" class="arrow-btn">▲</button>
            </div>
            <div class="arrow-row">
              <button id="target-left-btn" class="arrow-btn">◀</button>
              <button id="target-center-pad-btn" class="arrow-btn small">●</button>
              <button id="target-right-btn" class="arrow-btn">▶</button>
            </div>
            <div class="arrow-row">
              <button id="target-down-btn" class="arrow-btn">▼</button>
            </div>
          </div>
        </div>
      </section>


      <!-- 에러 그래프 -->
      <section class="card full-width">
        <h2>Error over Time</h2>
        <canvas id="error-chart" height="50"></canvas>
      </section>
    </div>


    <!-- 외부 라이브러리 CDN -->
    <!-- three.js -->
    <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Socket.IO client -->
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"
            crossorigin="anonymous"></script>

    <!-- 우리 JS들 -->
    <script src="{{ url_for('static', filename='js/three_scene.js') }}"></script>
    <script src="{{ url_for('static', filename='js/charts.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  </body>
</html>
