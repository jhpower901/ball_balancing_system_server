<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Ball Balancer Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
  </head>
  <body>
    <h1>Ball Balancer Web Dashboard</h1>

    <div id="status-box">
      SocketIO status:
      <span id="socket-status" class="status-disconnected">Disconnected</span>
      &nbsp;|&nbsp;
      Device info:
      <span id="device-id-label" class="info">(waiting for hello...)</span>
    </div>

    <div class="grid">
      <!-- 3D 플랫폼 -->
      <section class="card">
        <h2>Platform Pose (3D)</h2>
        <div id="platform-container"></div>
        <div class="pose-values small-note">
        roll: <span id="platform-roll-value">0.00</span>°
        &nbsp;&nbsp;
        pitch: <span id="platform-pitch-value">0.00</span>°
      </div>
      </section>

      <!-- Target Plane (실제 크기 + ball_pose) -->
      <section class="card">
        <h2>Target Plane</h2>
        <p class="small-note">
          Field size:
          <span id="field-size-label">unknown</span>
        </p>
        <canvas id="target-canvas"></canvas>
        <p class="small-note">
          ball pose: (
          <span id="ball-x-val">0.00</span>,
          <span id="ball-y-val">0.00</span>
          )
        </p>
      </section>

      <!-- Joystick 카드 -->
      <section class="card">
        <h2>Joystick</h2>
        <canvas id="joystick-canvas" width="260" height="260"></canvas>
        <p class="small-note">
          joystick (normalized): (
          <span id="joy-x-val">0.00</span>,
          <span id="joy-y-val">0.00</span>
          )
        </p>
      </section>

      <!-- 상태 raw 확인용 (디버깅용) -->
      <section class="card">
        <h2>Last status JSON (debug)</h2>
        <pre id="status-json" class="status-json"></pre>
      </section>

      <!-- PID Control Card -->
      <section class="card">
        <h2>PID Control</h2>

        <!-- Kp -->
        <div class="pid-row">
          <label for="kp-slider">Kp:</label>
          <input type="range" id="kp-slider" min="0" max="5" step="0.01" value="0">
          <span id="kp-value">0.00</span>
        </div>

        <!-- Ki -->
        <div class="pid-row">
          <label for="ki-slider">Ki:</label>
          <input type="range" id="ki-slider" min="0" max="5" step="0.01" value="0">
          <span id="ki-value">0.00</span>
        </div>

        <!-- Kd -->
        <div class="pid-row">
          <label for="kd-slider">Kd:</label>
          <input type="range" id="kd-slider" min="0" max="5" step="0.01" value="0">
          <span id="kd-value">0.00</span>
        </div>

        <!-- Target Pose -->
        <div class="pid-row">
          <label for="target-x">Target X:</label>
          <input type="number" id="target-x" step="0.01" value="0.0">
        </div>

        <div class="pid-row">
          <label for="target-y">Target Y:</label>
          <input type="number" id="target-y" step="0.01" value="0.0">
        </div>

        <button id="pid-apply-btn" class="pid-button">Apply</button>
      </section>


      <!-- 에러 그래프 -->
      <section class="card full-width">
        <h2>Error over Time</h2>
        <canvas id="error-chart" height="50"></canvas>
      </section>
    </div>


    <!-- 외부 라이브러리 CDN -->
    <!-- three.js -->
    <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Socket.IO client -->
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"
            crossorigin="anonymous"></script>

    <!-- 우리 JS들 -->
    <script src="{{ url_for('static', filename='js/three_scene.js') }}"></script>
    <script src="{{ url_for('static', filename='js/charts.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  </body>
</html>
